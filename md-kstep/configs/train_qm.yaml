seed: 42
k_steps: 4  # Start conservative (1 fs macro-step = 4 Ã— 0.25 fs)
batch_size: 256  # Smaller than MM due to limited QM data
grad_accum: 2  # Effective batch size 256
num_workers: 10  # Reduced from 10 to lower memory overhead
lr: 5.0e-5  # Lower LR for fine-tuning (was 1e-4)
lr_min: 5.0e-6
weight_decay: 5.0e-3
max_epochs: 100  # May need fewer if data is limited
steps_per_epoch: 500  # Adjust based on actual dataset size
amp: true
grad_clip: 1.0

# QM-specific: Velocity and force matching
lambda_vel: 1.0  # Match MM importance
lambda_com: 1.0e-1
lambda_force: 0.3  # Stronger force head regularization for QM

# Stronger structural regularization for QM (bonds/angles tighter)
lambda_struct_bond: 0.2    # Was 0.1 in QM baseline
lambda_struct_angle: 0.1   # Was 0.05 in QM baseline
lambda_struct_dihedral: 2.0e-2  # Was 1e-2 in QM baseline

val_every_steps: 3000  # Reduced from 100 for speed (validate every 2 epochs)
checkpoint_every_steps: 500  # More frequent saves (every epoch)
checkpoint_dir: outputs/checkpoints_qm
log_dir: outputs/logs_qm
resume: null

wandb:
  enabled: true
  project: md-kstep
  entity: dcerrone-dexterity3d
  run_name: null

# Data augmentation (critical for small QM datasets)
random_rotate: true
random_rotate_mode: per_graph  # More augmentation variety

struct_max_bonds: 256  # Reduced from 256 for 4x speedup
struct_max_angles: 256
struct_max_dihedrals: 256
max_val_batches: 100  # Limit validation to 100 batches (~25K samples) for speed

# Gradually ramp up structural penalties over initial epochs
curriculum_struct_epochs: 20
