seed: 42
k_steps: 4  # Start conservative (1 fs macro-step = 4 Ã— 0.25 fs)
batch_size: 128  # Smaller than MM due to limited QM data
grad_accum: 2  # Effective batch size 256
num_workers: 4
lr: 5.0e-5  # Lower LR for fine-tuning (was 1e-4)
lr_min: 5.0e-6
weight_decay: 5.0e-3
max_epochs: 100  # May need fewer if data is limited
steps_per_epoch: 500  # Adjust based on actual dataset size
amp: true
grad_clip: 1.0

# QM-specific: Velocity and force matching
lambda_vel: 1.0  # Match MM importance
lambda_com: 1.0e-1
lambda_force: 0.1  # Use force head for QM

# Stronger structural regularization for QM (bonds/angles tighter)
lambda_struct_bond: 0.1  # Was 0.05 in MM (2x increase)
lambda_struct_angle: 0.05  # Was 0.01 in MM (5x increase)
lambda_struct_dihedral: 1.0e-2  # Was 5e-3 in MM (2x increase)

val_every_steps: 100
checkpoint_every_steps: 1000
checkpoint_dir: outputs/checkpoints_qm
log_dir: outputs/logs_qm
resume: null

wandb:
  enabled: true
  project: md-kstep-qm
  entity: dcerrone-dexterity3d
  run_name: null

# Data augmentation (critical for small QM datasets)
random_rotate: true
random_rotate_mode: per_graph  # More augmentation variety

struct_max_bonds: 256
struct_max_angles: 256
struct_max_dihedrals: 256

